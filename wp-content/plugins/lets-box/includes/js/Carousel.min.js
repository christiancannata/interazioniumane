(function(t){"use strict";t(".LetsBox").on("letsbox-loaded",function(o,i){t(this).hasClass("carousel")&&t(this).WPCP_LetsBox_Carousel(i.options)})})(jQuery),function(t){"use strict";t.widget("cp.WPCP_LetsBox_Carousel",{options:{listtoken:null},_create:function(){this.options.topContainer=this.element.parent(),this.options.mainContainer=this.element.find(".wpcp-carousel"),this.options.loadingContainer=this.element.find(".loading"),this.options.carouselContainer=this.element.find(".wpcp-carousel-main-container"),this.options.slideTemplate=this.element.find(".wpcp-carousel-item-template .wpcp-carousel-item"),this.options.supportTouch=!!("ontouchstart"in window)&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||navigator.maxTouchPoints>1,this.options.listtoken=this.element.attr("data-token"),this.options.account_id=this.element.attr("data-account-id"),this.options.drive_id=this.element.attr("data-drive-id"),this.images={},this.images_total=0,this.carousel=!1;let t=parseFloat(this.options.carouselContainer.attr("data-items"));this.options.carousel={container:this.options.carouselContainer.get(0),autoWidth:"horizontal"===this.options.carouselContainer.attr("data-axis")&&"1"===this.options.carouselContainer.attr("data-auto-size"),autoHeight:"vertical"===this.options.carouselContainer.attr("data-axis")&&"1"===this.options.carouselContainer.attr("data-auto-size"),mode:"carousel",axis:this.options.carouselContainer.attr("data-axis"),items:1,slideBy:1,edgePadding:0,gutter:0,loop:!0,center:!1,speed:parseInt(this.options.carouselContainer.attr("data-speed")),controls:"1"===this.options.carouselContainer.attr("data-navigation-arrows"),controlsPosition:"bottom",controlsText:['<i class="eva eva-chevron-left"></i>','<i class="eva eva-chevron-right"></i>'],autoplay:"1"===this.options.carouselContainer.attr("data-autoplay"),autoplayDirection:this.options.carouselContainer.attr("data-autoplayDirection"),autoplayHoverPause:"1"===this.options.carouselContainer.attr("data-autoplayHoverPause"),autoplayTimeout:parseInt(this.options.carouselContainer.attr("data-autoplayTimeout")),autoplayText:["▶","❚❚"],autoplayButtonOutput:!1,nav:!1,navPosition:"bottom",arrowKeys:!0,mouseDrag:!0,swipeAngle:!1,responsive:{630:{items:t<2?1:2,slideBy:t<2?1:2,gutter:"0"===this.options.carouselContainer.attr("data-auto-size")?this.options.carouselContainer.attr("data-gutter"):1,nav:"1"===this.options.carouselContainer.attr("data-nav"),mouseDrag:!0,center:"1"===this.options.carouselContainer.attr("data-center")},900:{slideBy:parseFloat(this.options.carouselContainer.attr("data-slideBy"))<=t?parseFloat(this.options.carouselContainer.attr("data-slideBy")):t,items:t}}},this._initiate()},_destroy:function(){return this._super()},_setOption:function(t,o){this._super(t,o)},_initiate:function(){let t=this;t.options.topContainer.one("inview",function(o,i){t.load()})},load:function(){let t=this;var o=t.buildRequest();o({},t)},_initCarousel:function(o){var i=this;if(!1===o)return i.options.mainContainer.find(".wpcp-carousel-preloading").remove(),void i.showError();t.isEmptyObject(o)?i.showError():(i.images_total=o.total,i.addImages(o.images),i.options.carousel.responsive[900].items>i.images_total&&(i.options.carousel.responsive[900].items=i.images_total,i.options.carousel.responsive[630].items=i.images_total<2?1:2),i.carousel=tns(i.options.carousel),i.carousel.events.on("indexChanged",function(o,e){let a=o.index-o.items<0?0:o.index-o.items,n=Array.prototype.slice.call(o.slideItems,a,o.index+2*o.items);i._fetchImages(t(n).find(".wpcp-carousel-item-bg[data-src]"))}),i.carousel.events.emit("indexChanged",i.carousel.getInfo()),i.options.mainContainer.addClass("wpcp-carousel-loaded"),i.options.mainContainer.find(".wpcp-carousel-preloading").remove(),i._initLightbox(),i.setEvents(),"1"===i.element.attr("data-lightboxopen")&&i.element.find("div.ilightbox-group:visible").first().trigger("click"))},setEvents:function(){let o=this;t(o.options.carouselContainer).on({click:function(i){return!1===o.options.supportTouch||t(this).hasClass("is-touched")?(i.stopPropagation(),void(o.options.supportTouch?t(this).find(".entry_action_view").trigger("itap"):t(this).find(".entry_action_view").trigger("click"))):(o.options.carouselContainer.find(".wpcp-carousel-item.is-touched").removeClass("is-touched"),t(this).addClass("is-touched"),!1)}},".wpcp-carousel-item"),t(o.options.carouselContainer).on({click:function(i){var e=t(this).parents(".wpcp-carousel-item");return i.stopPropagation(),o.options.main._actionDownloadEntry(e,i)}},".entry_action_download"),t(o.options.carouselContainer).on({click:function(i){var e=t(this).parents(".wpcp-carousel-item");i.stopPropagation(),o.options.main._actionShareEntry(e,i)}},".entry_action_shortlink");let i=o.options.carouselContainer[0].querySelectorAll(".entry-description-button");t(i).on("click",function(t){t.stopPropagation()}),tippy(i,{trigger:"mouseenter focus click",arrow:!1,offset:0,content:function(t){return t.querySelector(".tippy-content-holder").innerHTML},maxWidth:350,allowHTML:!0,placement:"bottom",delay:[100,null],offset:[0,0],interactiveBorder:15,appendTo:o.element[0],moveTransition:"transform 0.2s ease-out",interactive:!0,onShow:function(t){tippy.hideAll()},onHide:function(t){}})},buildRequest:function(){let t=this;var o=o=>{t._initCarousel(o)};return t.options.main._pipeline({url:LetsBox_vars.ajax_url,type:"POST",dataType:"json",data:function(o){return o.action="letsbox-get-gallery",o.type="carousel",o.account_id=t.options.account_id,o.listtoken=t.options.listtoken,o.id=t.element.attr("data-id"),o._ajax_nonce=LetsBox_vars.gallery_nonce,o}},o)},addImages:function(o){let i=this;const e=Math.round(t(".wpcp-carousel").height()-20),a=Math.round(t(".wpcp-carousel").width());t.each(o,function(){var t=this;let o=i.options.slideTemplate.clone(),n=o.find(".wpcp-carousel-item-bg").get(0);if(n.setAttribute("data-src",t.url),o.attr("data-id",t.id).attr("data-name",t.name),i.options.carousel.autoWidth&&o.children().first().css({width:t.width&&t.height?Math.round(e*t.width/t.height):e,height:e}),i.options.carousel.autoHeight&&o.children().first().css({width:a,height:t.width&&t.height?Math.round(a*t.height/t.width):a}),o.find(".wpcp-carousel-item-date span").text(t.last_edited_time_str),o.find(".wpcp-carousel-item-title span").html(t.name),t.description?(o.find(".wpcp-carousel-item-description, .description-text").html(t.description),o.addClass("wpcp-has-description")):o.find(".wpcp-carousel-item-description").remove(),t.download_url&&o.find(".entry_action_download").attr("href",t.download_url),t.lightbox_link){let e=o.find(".entry_action_view");e.addClass("ilightbox-group"),e.attr("data-src",t.url),e.attr("data-type","image"),e.attr("rel","ilightbox['"+i.options.listtoken+"']"),e.attr("data-options","thumbnail:'"+t.url+"'"),t.description&&e.attr("data-caption",t.description)}i.images[t.id]=o,i.options.carouselContainer.append(o)})},_fetchImages:function(o){var i=this;t.each(o,function(){t(this).css({"background-image":'url("'+t(this).attr("data-src")+'")'}),t(this).addClass("wpcp-carousel-item-bg-loading")});let e=imagesLoaded(i.options.carouselContainer.get(0),{background:".wpcp-carousel-item-bg-loading"});e.on("progress",function(o,i){var e=i.isLoaded?"loaded":"broken";let a=t(i.element);a.removeClass("wpcp-carousel-item-bg-loading"),"broken"!==e&&(a.removeClass("preloading").removeAttr("data-src"),a.prev(".preloading").remove(),a.css("opacity",1),a.parents(".wpcp-carousel-item").find(".wpcp-carousel-item-overlay").addClass("wpcp-visible"),a.parents(".wpcp-carousel-item").find(".wpcp-carousel-item-text").css("opacity",1))})},showError:function(){let t=this;t.options.carouselContainer.html('<p style="text-align:center;">'+t.options.str_no_filelist+"</p>")},_initLightbox:function(){let o,i=this,e="1"===i.element.attr("data-lightboxnav"),a="1"===i.element.attr("data-lightboxthumbs"),n=!1,s=!1;"click"===i.options.lightbox_showcaption?o=s="click":"mouseenter"===i.options.lightbox_showcaption?(o=i.options.lightbox_showcaption,s="mouseleave"):"false"==i.options.lightbox_showcaption||"No"==i.options.lightbox_showcaption?(o=!1,s=!1):(n=!0,o=!0,s=!0);let r={WPCP:i,skin:"LetsBox wpcp-lightbox "+i.options.lightbox_skin,path:i.options.lightbox_path,attr:"data-src",maxScale:1,minScale:.05,infinite:!0,slideshow:{pauseOnHover:!1,pauseTime:parseInt(i.options.carouselContainer.attr("data-autoplayTimeout")),startPaused:"1"!==i.element.attr("data-slideshow")},controls:{slideshow:e,arrows:e,thumbnail:a},caption:{start:n,show:o,hide:s},headerHeight:50,header:{start:!1,show:!1,hide:!1},thumbnails:{normalOpacity:.9,activeOpacity:1,maxHeight:100},show:{effect:!1},hide:{effect:!1},overlay:{opacity:1},keepAspectRatio:!0,callback:{onBeforeLoad:function(o,e){t(".ilightbox-holder").attr("data-token",i.options.listtoken)},onOpen:function(){i.carousel.pause()},onHide:function(){let o=this.ui.currentElement.find(".ilightbox-container [src]"),e=t('.entry_action_view[data-src="'+o.attr("src")+'"]:first').parents(".wpcp-carousel-item").index();i.carousel.goTo(e-i.carousel.getInfo().cloneCount),i.carousel.play()},onShow:function(o,e){let a=this;new LazyLoad({data_src:window.devicePixelRatio>1?"src-retina":"src",unobserve_entered:!0,use_native:!1,elements_selector:".ilightbox-thumbnail img.preloading",class_applied:"wpcp-lazy-applied",class_loading:"wpcp-lazy-loading",class_loaded:"wpcp-lazy-loaded",class_error:"wpcp-lazy-error",callback_loaded:function(o){t(o).removeClass("preloading preloading-lightbox-thumbnail"),t(o).prev(".preloading").remove(),t(o).parent().data({naturalWidth:o.width,naturalHeight:o.height}),a.positionThumbnails(null,null,null)},callback_load:function(o){t(o).removeClass("preloading preloading-lightbox-thumbnail"),t(o).prev(".preloading").remove(),t(o).parent().data({naturalWidth:o.width,naturalHeight:o.height}),a.positionThumbnails(null,null,null)}}),t(".ilightbox-container .ilightbox-wrapper, .ilightbox-container img, .ilightbox-container video, .ilightbox-container audio").on("contextmenu",function(t){return"Yes"===i.options.lightbox_rightclick||(t.preventDefault(),t.stopPropagation(),!1)});let n=o.currentElement.find(".ilightbox-container [src]");if(n.length>0&&1!==n.data("logged")){var s=t('.entry_action_view[data-src="'+n.attr("src")+'"]:first').parents(".wpcp-carousel-item").attr("data-id");n.data("logged",1),i.options.main._logEvent("log_preview_event",s)}}},errors:{loadImage:i.options.str_imgError_title,loadContents:i.options.str_xhrError_title},text:{next:i.options.str_next_title,previous:i.options.str_previous_title,slideShow:i.options.str_startslideshow},candownload:!1};if(e){t.isEmptyObject(this.lightBox)||i.lightBox.destroy();let o=i.element.find(".ilightbox-group");i.lightBox=o.WPCP_iLightBox(r)}else t.isEmptyObject(this.lightBox)||t.each(this.lightBox,function(){this.destroy()}),i.lightBox=[],i.element.find(".ilightbox-group").each(function(){i.lightBox.push(t(this).WPCP_iLightBox(r))})}})}(jQuery);